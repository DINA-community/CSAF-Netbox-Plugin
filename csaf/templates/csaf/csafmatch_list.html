{% extends base_template %}
{% load buttons %}
{% load i18n %}
{% load render_table from django_tables2 %}

{% block extra_controls %}
  {% with viewname=object %}
    <a href="{% url 'plugins:csaf:synchronisers' %}?trigger=1&{{ link_name }}={{ object.pk }}" class="btn btn-primary">
      <i class="mdi mdi-plus-thick" aria-hidden="true"></i> {% trans "Trigger Matching Run" %}
    </a>
  {% endwith %}
  {% if perms.csaf.add_csafmatch %}
    {% with viewname=object %}
      <a href="{% url 'plugins:csaf:csafmatch_add' %}?{{ link_name }}={{ object.pk }}&return_url={{ return_url }}" class="btn btn-primary">
        <i class="mdi mdi-plus-thick" aria-hidden="true"></i> {% trans "Add a Match" %}
      </a>
    {% endwith %}
  {% endif %}
{% endblock %}

{% block content %}
  <div class="row mb-3">

    <div class="row mb-3">
      <div class="col-auto table-controls noprint">
        <a class="btn {% if status.N %}btn-success{% else %}btn-info{% endif %}" role="button" href="{{ request.path }}?statusString={{ statusString }}&toggle=N">New</a>
        <a class="btn {% if status.O %}btn-success{% else %}btn-info{% endif %}" role="button" href="{{ request.path }}?statusString={{ statusString }}&toggle=O">Reopened</a>
        <a class="btn {% if status.C %}btn-success{% else %}btn-info{% endif %}" role="button" href="{{ request.path }}?statusString={{ statusString }}&toggle=C">Confirmed</a>
        <a class="btn {% if status.R %}btn-success{% else %}btn-info{% endif %}" role="button" href="{{ request.path }}?statusString={{ statusString }}&toggle=R">Resolved</a>
        <a class="btn {% if status.F %}btn-success{% else %}btn-info{% endif %}" role="button" href="{{ request.path }}?statusString={{ statusString }}&toggle=F">False Positive</a>
        &nbsp;&nbsp;
      </div>
    </div>

    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="statusString" value="{{ statusString }}">
      <input type="hidden" name="return_url" value="{{ return_url }}">
      <div class="col col-md-12">
        <div class="card">
          <div class="htmx-container table-responsive" id="object_list">
            {% render_table table 'inc/table.html' %}
            {% include 'inc/paginator.html' with paginator=table.paginator page=table.page %}
          </div>
        </div>
        {% block bulk_buttons %}
            <div class="dropdown">
              <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="mdi mdi-plus-thick" aria-hidden="true"></i> {% trans "Bulk Set Status" %}
              </button>
              <ul class="dropdown-menu">
                  <li>
                    <button type="submit" {% formaction %}="{{ request.path }}" class="dropdown-item" name="targetStatus" value="N">
                    {% trans "New" %}
                    </button>
                  </li>
                  <li>
                    <button type="submit" {% formaction %}="{{ request.path }}" class="dropdown-item" name="targetStatus" value="O">
                      {% trans "Reopened" %}
                    </button>
                  </li>
                  <li>
                    <button type="submit" {% formaction %}="{{ request.path }}" class="dropdown-item" name="targetStatus" value="C">
                      {% trans "Confirmed" %}
                    </button>
                  </li>
                  <li>
                    <button type="submit" {% formaction %}="{{ request.path }}" class="dropdown-item" name="targetStatus" value="R">
                      {% trans "Resolved" %}
                    </button>
                  </li>
                  <li>
                    <button type="submit" {% formaction %}="{{ request.path }}" class="dropdown-item" name="targetStatus" value="X">
                      {% trans "False Positive" %}
                    </button>
                  </li>
              </ul>
            </div>
          {% if 'bulk_delete' in actions %}
            {% bulk_delete_button model query_params=request.GET %}
          {% endif %}
        {% endblock %}

      </div>
    </form>
  </div>
{% endblock %}
